# 简化云编程：无服务器计算的伯克利观点

Eric Jonas Johann Schleier-Smith Vikram Sreekanti Chia-Che Tsai Anurag Khandelwal Qifan Pu Vaishaal Shankar Joao Menezes Carreira Karl Krauth Neeraja Yadwadkar Joseph Gonzalez Raluca Ada Popa Ion Stoica David A. Patterson

加州大学伯克利分校电气工程与计算机科学技术报告编号UCB / EECS-2019-3 http://www2.eecs.berkeley.edu/Pubs/TechRpts/2019/EECS-2019-3.html

2019年2月10日

版权所有©2019，作者。版权所有。

允许将个人或教室使用的全部或部分作品的数字或硬拷贝免费授予，前提是副本不是为了利润或商业利益而制作或分发的，并且副本承担此通知并在第一页上完整引用。要以其他方式进行复制，重新发布，在服务器上发布或重新分发到列表，需要事先获得特定权限。

承认

RISELab的赞助商是阿里巴巴集团，亚马逊网络服务，蚂蚁金融，Arm Holdings，Capital One，爱立信，Facebook，谷歌，华为，英特尔，微软，丰业银行，Splunk，VMware和国家科学基金会。

## 简化云编程：无服务器计算的伯克利观点

Eric Jonas Johann Schleier-Smith Vikram Sreekanti Chia-Che Tsai Anurag Khandelwal Qifan Pu Vaishaal Shankar Joao Carreira Karl Krauth Neeraja Yadwadkar Joseph E. Gonzalez Raluca Ada Popa Ion Stoica David A. Patterson

加州大学伯克利分校

serverlessview@berkeley.edu

### 抽象

无服务器云计算几乎处理所有系统管理操作，使程序员更容易使用云。它提供了一个极大简化云编程的接口，代表了从汇编语言到高级编程语言的过渡。本文简要介绍了云计算的历史，包括对2009年伯克利云计算视图的预测进行了说明，解释了无服务器计算的动机，描述了扩展无服务器当前限制的应用程序，然后列出了障碍和研究机会无服务器计算需要充分发挥其潜力。正如2009年的论文确定了云的挑战并预测它们将得到解决以及云的使用会加速，我们预测这些问题是可以解决的，无服务器计算将成为云计算未来的主导。

目录1无服务器计算简介3 2无服务器计算的出现5 2.1无服务器计算的上下文。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 6 2.2无服务器计算的吸引力。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 8 3今天的无服务器计算平台的局限性9 3.1细粒度操作的存储空间不足。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 12 3.2缺乏细粒度的协调。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 12 3.3标准通信模式的性能不佳。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 13 3.4可预测的绩效。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 14 4无服务器计算应该成为什么15 4.1抽象挑战。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 15 4.2系统挑战。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 16 4.3网络挑战。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 18 4.4安全挑战。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 18 4.5计算机架构的挑战。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 19 5谬误和陷阱20 6摘要和预测21 7致谢23 8附录。更多关于延伸今天的无服务器计算的五个应用程序的深度29 8.1 ExCamera：实时视频编码。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 29 8.2 MapReduce。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 29 8.3 Numpywren：线性代数。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 30 8.4 Cirrus：机器学习培训。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 32 8.5无服务器SQLite：数据库。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 。 32

### 1无服务器计算简介

数据中心现在是计算机。 Luiz Barroso（2007）[1]

2009年，为了帮助解释围绕云计算的兴奋，“伯克利云计算观点”[2]确定了六个潜在优势：

1. 按需出现无限的计算资源。
2. 消除云用户的前期承诺。
3. 能够根据需要在短期内支付使用计算资源的费用。
4. 由于许多非常大的数据中心，显着降低了成本的规模经济。
5. 通过资源虚拟化简化操作并提高利用率。
6. 通过复用来自不同组织的工作负载来提高硬件利用率。

在过去十年中，这些优势已经基本实现，但云用户继续承担复杂运营的负担，许多工作负载仍然无法从高效的多路复用中受益。这些不足主要与未能实现最后两个潜在优势相对应。云计算减轻了物理基础设施管理的用户，但却为他们提供了大量的虚拟资源来管理。多路复用适用于批处理工作负载，例如MapReduce或高性能计算，可以充分利用它们分配的实例。它对状态服务的效果较差，例如将数据库管理系统等企业软件移植到云端时

2009年，云中存在两种相互竞争的虚拟化方法。正如论文解释的那样：

亚马逊EC2处于频谱的一端。 EC2实例看起来很像物理硬件，用户可以从内核向上控制几乎整个软件堆栈。 ......另一个极端的应用领域特定平台，如Google App Engine ......强制实施无状态计算层和有状态存储层之间清晰分离的应用程序结构。 App Engine令人印象深刻的自动扩展和高可用性机制......依赖于这些限制。

市场最终采用了亚马逊的低级虚拟机云计算方法，因此谷歌，微软和其他云公司提供了类似的界面。我们认为低级虚拟机成功的主要原因是，在云计算的早期阶段，用户希望在云中重建与他们在本地计算机上相同的计算环境，以简化将工作负载移植到云端[ 3 {6]。理所当然地，这种实际需求优先于仅为云编写新程序，特别是因为不清楚云的成功程度。

这种选择的缺点是开发人员必须自己管理虚拟机，基本上要么成为系统管理员，要么与他们一起设置环境。表1列出了在云中运行环境必须管理的问题。一长串的低级虚拟机管理职责激励客户使用更简单的应用程序，为新应用程序提供更轻松的云路径。例如，假设

1由于计算和存储之间的紧密耦合，数据库需要长期保留实例。但是，它们的工作负载可能是突发性的，从而导致资源利用率低。

1. 可用性冗余，因此单个机器故障不会导致服务中断。
2. 冗余副本的地理分布，以便在发生灾难时保留服务。
3. 负载平衡和请求路由以有效利用资源。
4. 自动缩放以响应负载变化以扩大或缩小系统。
5. 监控以确保服务仍然运行良好。
6. 记录以记录调试或性能调整所需的消息。
7. 系统升级，包括安全修补。
8. 在新实例可用时迁移到新实例。

表1：为云用户设置环境需要解决的八个问题。有些问题需要很多步骤。例如，自动缩放需要确定扩展的需要;选择要使用的服务器的类型和数量;请求服务器;等他们上网;使用应用程序配置它们;确认没有发生错误;使用监测工具对其进行检测;并向他们发送流量以测试他们。

应用程序想要将图像从手机应用程序发送到云，这应该创建缩略图图像，然后将它们放在网络上。完成这些任务的代码可能是几十行JavaScript，与使用适当的环境来运行代码来设置服务器相比，这将是一个微不足道的开发。

对这些需求的认识导致2015年亚马逊推出了一项名为AWS Lambda服务的新选项。 Lambda提供了云功能，并引起了对无服务器计算的广泛关注。虽然无服务器计算可以说是一种矛盾，但你仍然在使用服务器来计算这个名称，因为它表明云用户只需编写代码并将所有服务器配置和管理任务留给云提供商。虽然云功能|打包为FaaS（功能即服务）产品2 |代表无服务器计算的核心，但云平台还提供专门的无服务器框架，以满足特定的应用需求，如BaaS（后端即服务）产品[7]。简而言之，无服务器计算= FaaS + BaaS.3在我们的定义中，对于服务被视为无服务器，它必须自动扩展而无需显式配置，并根据使用情况进行计费。在本文的其余部分，我们将重点关注云功能的出现，发展和未来。云功能是当今无服务器计算中的通用元素，并引领着云的简化和通用编程模型。

接下来，我们将激励并定义无服务器计算。与最初的关于云计算的Berkeley View论文一样，我们列出了无服务器计算需要解决的挑战和研究机会，以实现其承诺。虽然我们不确定哪种解决方案会获胜，但我们相信所有问题都将最终得到解决，从而使无服务器计算成为云计算的代表。

2D不同的云平台为其FaaS产品提供了不同的名称| AWS Lambda for Amazon Web Services（AWS），Google Cloud Functions for Google Cloud Platform，IBM Cloud Functions for IBM Cloud和Azure Functions for Microsoft Azure。它们都具有相似的功能，我们在本文中将它们称为云功能或FaaS产品。

3BaaS起源于描述以移动为中心的云框架，并且已经发展到包含任何特定于应用程序的无服务器云服务，例如无服务器数据库和无服务器大数据处理框架。

### 2无服务器计算的出现

在任何无服务器平台中，用户只需用高级语言编写云功能，选择应该触发功能运行的事件，例如将图像加载到云存储中或将图像缩略图添加到数据库表中，以及让无服务器系统处理其他所有事情：实例选择，扩展，部署，容错，监视，日志记录，安全补丁等。表2总结了无服务器和传统方法之间的区别，我们在本文中称之为服务器云计算。请注意，这两种方法代表了基于函数/服务器中心的计算平台的连续体的端点，其中容器化的编排框架如Kubernetes代表中间体。

特性AWS无服务器云AWS Serverful Cloud PROGRAMMER程序运行时由Cloud用户选择的事件连续直到显式停止编程语言JavaScript，Python，Java，Go，C＃等.4任何程序状态保存在存储中（无状态）任何地方（有状态）或无状态）最大内存大小0.125  -  3 GiB（云用户选择）0.5  -  1952 GiB（云用户选择）最大本地存储0.5 GiB 0  -  3600 GiB（云用户选择）最大运行时间900秒无最小会计单位0.1秒60秒每个会计单位的价格$ 0.0000002（假设0.125 GiB）$ 0.0000867  -  $ 0.4080000操作系统和库云提供商选择5云用户选择SYSADMIN服务器实例云提供商选择云用户选择Scaling6云提供商负责云用户负责部署云提供商负责云用户负责容错云提供商负责云用户负责监控云提供商负责云用户响应ible Logging云提供商负责云用户负责

表2：无服务器云功能与服务器云VM的特征分为编程和系统管理类别。规格和价格对应于AWS Lambda和按需AWS EC2实例。

图1说明了无服务器如何通过使云资源更易于使用来简化应用程序开发。在云环境中，服务器计算就像用低级汇编语言编程，而无服务器计算就像用Python等高级语言编程。计算简单表达式（如c = a + b）的汇编语言程序员必须选择一个或多个要使用的寄存器，将值加载到这些寄存器中，执行算术运算，然后存储结果。这反映了服务器云编程的几个步骤，其中首先提供资源或识别可用的资源，然后使用必要的代码和数据加载这些资源，执行计算，返回或存储结果，并最终管理资源释放。无服务器计算的目标和机会是为云程序员提供类似于向高级编程语言过渡的优势.7高级编程环境的其他功能在无服务器计算中也有自然的相似之处。自动内存管理减轻了程序员管理内存资源的负担，而无服务器计算使程序员无法管理服务器资源。

准确地说，无服务器和服务器计算之间存在三个关键区别：

> 虽然除了高级语言程序之外，一些无服务器计算提供商还运行二进制程序，但我们认为无服务器的最大优势在于使用高级语言。

1. 解耦计算和存储。存储和计算分别单独提供和定价。通常，存储由单独的云服务提供，并且计算是无状态的。
2. 执行代码而不管理资源分配。用户不是请求资源，而是提供一段代码，云自动提供资源来执行该代码。
3. 按使用的资源而不是分配的资源按比例支付。计费是与执行相关联的某些维度，例如执行时间，而不是基础云平台的维度，例如分配的VM的大小和数量。使用这些区别，我们接下来解释无服务器如何与过去和现在的类似产品不同。

无服务器硬件基础云平台抽象应用程度VPC块虚拟机存储云功能对象存储键值数据库大数据转换消息服务器网络存储加速器Web API事件数据处理未来无服务器应用程序IAM计费大数据查询移动后端数据库监控未来无服务器云服务

图1：无服务器云的架构。无服务器层位于应用程序和基础云平台之间，简化了云编程。云功能（即FaaS）提供通用计算，并由专门的后端即服务（BaaS）产品生态系统（如对象存储，数据库或消息传递）进行补充。具体而言，AWS上的无服务器应用程序可能将Lambda与S3（对象存储）和DynamoDB（键值数据库）一起使用，而Google云上的应用程序可能将Cloud Functions与Cloud Firestore（移动后端数据库）和Cloud Pub / Sub（消息传递）一起使用）。 Serverless还包括某些大数据服务，如AWS Athena和Google BigQuery（大数据查询），以及Google Cloud Dataflow和AWS Glue（大数据转换）。基础底层基础云平台包括虚拟机（VM），专用网络（VPC），虚拟化块存储，身份和访问管理（IAM），以及计费和监控。

#### 2.1无服务器计算的上下文

需要哪些技术突破才能实现无服务器计算？有人认为无服务器计算仅仅是对先前产品的重新定义，可能是平台即服务（PaaS）云产品（如Heroku [8]，Firebase [9]或Parse [10]）的适度概括。其他人可能会指出，20世纪90年代流行的共享Web托管环境提供了无服务器计算所提供的大部分内容。例如，它们有一个无状态编程模型，允许高水平的多租户，对可变需求的弹性响应，以及标准化的函数调用API，即公共网关接口（CGI）[11]，它甚至允许直接部署写入的源代码在Perl或PHP等高级语言中。谷歌的原始App Engine在无服务器计算普及之前几年被市场拒绝，也允许开发人员部署代码，同时将大多数操作方面留给云提供商。我们相信无服务器计算代表了PaaS和其他先前型号的重大创新。

今天，具有云功能的无服务器计算与其前代产品的不同之处在于几个基本方面：更好的自动扩展，强大的隔离，平台灵活性和服务生态系统支持。在这些因素中，AWS Lambda提供的自动缩放标记与以前的标记有明显的不同。它以比服务器自动缩放技术更高的保真度跟踪负载，在需要时快速响应扩展，并在没有需求的情况下一直缩减到零资源和零成本。它以更细粒度的方式收费，在按小时计费的其他自动调节服务时提供100毫秒的最小计费增量.8在关键的离开时，它向客户收取其代码实际执行时间的费用，不是为执行他们的程序保留的资源。这种区别确保了云提供商在游戏中的“皮肤”自动缩放，从而提供了确保有效资源分配的激励措施。

无服务器计算依赖于强大的性能和安全隔离，使多租户硬件共享成为可能。类似VM的隔离是云功能的多租户硬件共享的当前标准[12]，但由于VM配置可能需要很长时间，因此无服务器计算提供商使用复杂的技术来加速功能执行环境的创建。 AWS Lambda中反映的一种方法是维护一个\ hot pool“VM实例”，这些VM实例只需要分配给租户和一个“活动池”，这些实例之前已经用于运行某个功能并维护以便为将来服务调用[13]。实现高利用率所必需的资源生命周期管理和多租户仓包装是无服务器计算的关键技术推动者。我们注意到，最近的一些提案旨在通过利用容器，unikernel，库操作系统或语言VM来减少提供多租户隔离的开销。例如，Google宣布gVisor [14]已被App Engine，Cloud Functions和Cloud ML Engine采用，亚马逊发布了用于AWS Lambda和AWS Fargate的Firecracker VM [15]，而CloudFlare Workers无服务器平台提供了多个使用Web浏览器沙盒技术在JavaScript云功能之间进行租户隔离[16]。

其他一些区别帮助无服务器计算成功。通过允许用户使用自己的库，无服务器计算可以支持比与特定用例紧密相关的PaaS服务更广泛的应用程序。无服务器计算在现代数据中心中运行，并且比旧的共享Web托管环境以更大的规模运行。

如第1节所述，云功能（即FaaS）推广了无服务器范例。但是，值得承认的是，他们的成功部分归功于自公共云开始以来存在的BaaS产品，如AWS S3等服务。在我们看来，这些服务是特定于域的，高度优化的无服务器计算实现。云功能以更一般的形式表示无服务器计算。我们通过比较几种服务的编程接口和成本模型，总结了表3中的这一观点。

讨论无服务器计算的一个常见问题是它与Kubernetes的关系[17]，

> 8例如，AWS Elastic Beanstalk或Google App Engine。

服务编程接口成本模型云函数任意代码函数执行时间BigQuery / Athena类似SQL的查询查询扫描的数据量DynamoDB puts（）和gets（）Per put（）或get（）request + storage SQS enqueue / dequeue每个API调用的事件

表3：无服务器计算服务及其相应的编程接口和成本模型的示例。请注意，对于此处描述的无服务器计算产品：BigQuery，Athena和云功能，用户单独为存储付费（例如，在Google云端存储，AWS S3或Azure Blob存储中）。

用于部署微服务的技术。与无服务器计算不同，Kubernetes是一种简化服务器计算管理的技术。源于Google内部使用的多年开发[18]，它正在迅速普及.Kubernetes可以提供短命的服务计算环境，如无服务器计算，并且具有更少的限制，例如，在硬件资源，执行时间和网络通信方面。它还可以将最初为内部部署使用而开发的软件完全部署在公共云上，几乎没有修改。无服务器计算，另一方面，引入了一种范式转换，允许将运营职责完全卸载到提供商，并实现细粒度的多租户复用。托管Kubernetes产品，例如Google Kubernetes Engine（GKE）和AWS Elastic Kubernetes Service（EKS）在这个连续统一体中提供了一个中间立场：他们在givi的同时卸下了Kubernetes的运营管理开发人员可灵活配置任意容器。托管Kubernetes服务和无服务器计算之间的一个关键区别是计费模型。前者按预留资源收费，而后者按功能执行持续时间收费。

Kubernetes也是混合应用程序的完美搭档，其中一部分在本地硬件上运行，一部分在云中运行。我们的观点是，这种混合应用程序在向云的过渡中是有意义的。然而，从长远来看，我们相信云规模经济，更快的网络带宽，不断增长的云服务以及通过无服务器计算简化云管理将降低此类混合应用的重要性。

边缘计算是PostPC时代云计算的合作伙伴，虽然我们关注的是无服务器计算将如何改变数据中心内的编程，但也有可能在边缘产生影响。多个内容分发网络（CDN）运营商提供了在靠近用户[19,20]的设施中执行无服务器功能的能力，无论他们在哪里，AWS IoT Greengrass [21]甚至可以在边缘设备中嵌入无服务器执行。现在我们已经定义了无服务器计算和上下文化，让我们看看为什么它对云提供商，云用户和研究人员具有吸引力。

#### 2.2无服务器计算的吸引力

对于云提供商而言，无服务器计算可促进业务增长，因为使云更容易编程有助于吸引新客户并帮助现有客户更多地使用云产品。例如，最近的调查发现，大约24％的无服务器用户不熟悉云计算[22]，30％的现有服务器云客户也使用无服务器计算[23]。此外，短时间，小内存占用和无状态特性通过使云提供商更容易找到运行这些任务的未使用资源来改善统计复用。云提供商也可以使用不那么受欢迎的计算机，因为实例类型最多

百分比使用案例

32％Web和API服务21％数据处理，例如批量ETL（数据库提取，转换和加载）17％集成第三方服务16％内部工具8％聊天机器人，例如Alexa Skills（Alexa AI Assistant SDK）6 ％ 物联网

表4：根据2018年的调查[22]，无服务器计算用例的普及程度。

云服务提供商|例如旧服务器可能对服务器云客户的吸引力较小。这两项福利都会增加现有资源的收入

客户受益于提高的编程生产力，并且在许多情况下也可以节省成本，这是底层服务器利用率更高的结果。即使无服务器计算让客户更有效率，Jevons悖论[24]表明他们将增加对云的使用，而不是削减，因为更高的效率将增加用户的需求。

无服务器还提高了x86机器代码的云部署水平| 99％的云计算机使用x86指令集到高级编程语言，9这些都支持架构创新。如果ARM或RISC-V提供比x86更好的性价比，则无服务器计算可以更轻松地更改指令集。云提供商甚至可以接受面向语言优化和特定领域架构的研究，这些架构专门用于加速用Python等语言编写的程序[25]（参见第4节）。

云用户喜欢无服务器计算，因为新手可以在不了解云基础架构的情况下部署功能，因为专家可以节省开发时间并专注于应用程序独有的问题。无服务器用户可以节省资金，因为只有在事件发生时才执行功能，细粒度会计（现在通常为100毫秒）意味着他们只为他们使用的东西而不是他们保留的东西付费。表4显示了当今无服务器计算的最流行用途。

研究人员已经被无服务器计算，尤其是云计算功能所吸引，因为它是一种新的通用计算抽象，有望成为云计算的未来，并且因为有很多机会可以提升当前性能并克服当前的局限性。

### 3今天无服务器计算平台的局限性

无服务器云功能已成功用于多类工作负载10，包括API服务，事件流处理和有限的ETL11（参见表3）。为了了解哪些障碍阻碍了支持更多的常规工作负载，我们尝试创建我们感兴趣的无服务器版本的应用程序，并研究其他人发布的示例。这些并非意图

> 9虽然除了高级语言程序之外，一些无服务器计算提供商还运行二进制程序，但我们认为无服务器的最大优势在于使用高级语言。

> 10参见\用例“这里：https：//aws.amazon.com/lambda/。

> 11使用今天的云功能实现的ETL通常仅限于仅映射处理。

代表当前无服务器计算生态系统之外的其他信息技术;它们只是为了发现可能阻止许多其他有趣应用程序的无服务器版本的常见弱点而选择的示例。

在本节中，我们概述了五个研究项目，并讨论了阻碍现有无服务器计算平台实现最先进性能的障碍，即为相同工作负载匹配服务器云的性能。我们特别关注利用通用云计算功能进行计算的方法，而不是过分依赖其他特定于应用程序的无服务器产品（BaaS）。然而，在我们的最后一个例子，无服务器SQLite中，我们确定了一个用于映射如此糟糕的FaaS的用例，我们得出的结论是数据库和其他状态繁重的应用程序将保留为BaaS。本文末尾的附录详细介绍了每个应用程序。

有趣的是，即使这种折衷的应用程序组合也暴露了类似的弱点，我们在描述应用程序后列出了这些弱点。表5总结了五种应用。

ExCamera：实时视频编码。 ExCamera [26]旨在为用户上传视频到YouTube等网站提供实时编码服务。根据视频的大小，今天的编码解决方案可能需要几十分钟甚至几小时。为了实时执行编码，ExCamera将编码的“慢”部分并行化，并按顺序执行\ fast“部分。 ExCamera公开了视频编码器和解码器的内部状态，允许使用纯函数语义执行编码和解码任务。特别地，每个任务将内部状态与视频帧一起作为输入，并将修改的内部状态作为输出发出。

MapReduce的。 MapReduce，Hadoop和Spark等分析框架传统上部署在托管集群上。虽然其中一些分析工作负载现在转向无服务器计算，但这些工作负载主要由仅映射作业组成。自然的下一步是支持完全成熟的MapReduce工作。这项工作背后的驱动力之一是利用无服务器计算的灵活性来有效地支持资源需求在执行期间显着变化的作业。

Numpywren：线性代数。大规模线性代数计算传统上部署在由高速，低延迟网络连接的超级计算机或高性能计算集群上。鉴于此历史，无服务器计算最初似乎不合适。然而，无线服务器计算对线性代数计算仍然有意义的原因有两个。首先，管理集群是许多非CS科学家的一大障碍[27]。其次，在计算过程中，并行度可能会发生很大变化。配置具有固定大小的群集将减慢作业速度或使群集未得到充分利用。

Cirrus：机器学习培训。机器学习（ML）研究人员传统上使用VM群集来处理ML工作流程中的不同任务，例如预处理，模型训练和超参数调整。这种方法的一个挑战是该管道的不同阶段可能需要显着不同的资源量。与线性代数算法一样，固定的簇大小将导致严重的未充分利用或严重的减速。无服务器计算可以通过扩展每个阶段来满足其资源需求来应对这一挑战。此外，它使开发人员免于管理集群。

无服务器SQLite：数据库。各种自动调节数据库服务已经存在[28 {33]，但为了更好地理解无服务器计算的局限性，了解是什么使数据库工作负载实施起来特别具有挑战性非常重要。在此上下文中，我们考虑第三方是否可以使用云功能（通用无服务器计算构建块）直接实现无服务器数据库。一个简单的解决方案是在云功能中运行常见的事务数据库，例如PostgreSQL，Oracle或MySQL。然而，这立即遇到了许多挑战。首先，无服务器计算没有内置的持久存储，因此我们需要利用一些远程持久存储，这会引入大量的la-

应用说明挑战解决方案成本效益

实时视频压缩（ExCamera）即时视频编码对象存储太慢，无法支持细粒度通信;功能太粗糙，无法完成任务。功能 - 功能通信以避免对象存储;一个函数执行多个任务。比VM实例快60倍，便宜6倍。 MapReduce大数据处理（排序100TB）由于对象存储延迟和IOPS限制，Shuffle无法扩展。具有低延迟，高IOPS以加速混洗的小存储。排序100 TB比VM实例快1％，成本增加15％。线性代数（Numpywren）大规模线性代数需要大问题大小来克服存储（S3）延迟，难以实现高效广播。存储具有低延迟高吞吐量，可处理较小的问题。完成时间缩短了3倍。 CPU资源消耗降低1.26倍至2.5倍。 ML管道（Cirrus）大规模ML培训缺乏快速存储来实现参数服务器;难以实现高效的广播，聚合。存储具有低延迟，高IOPS以实现参数服务器。比VM实例快3到5倍，总成本高出7倍。数据库（无服务器SQLite）应用程序的主状态（OLTP）缺少共享内存，对象存储具有高延迟，缺乏对入站连接的支持。如果写入需求低，共享文件系统可以工作。每次交易的成本比公布的TPC-C基准高3倍。读取比例匹配但写入不匹配。

表5：无服务器计算的新应用领域要求摘要。

tency。其次，这些数据库假定面向连接的协议，例如，数据库作为接受来自客户端的连接的服务器运行。此假设与在网络地址转换器后面运行的现有云功能冲突，因此不支持传入连接。最后，虽然许多高性能数据库依赖于共享内存[34]，但云功能是孤立运行的，因此无法共享内存。虽然无共享分布式数据库[35 {37]不需要共享内存，但他们希望节点保持在线并可直接寻址。所有这些问题都对在无服务器计算上运行传统数据库软件或实现等效功能提出了重大挑战，因此我们希望数据库保持为BaaS。

这些应用程序希望使用无服务器计算的关键原因之一是细粒度自动缩放，因此资源利用率与每个应用程序的不同需求密切匹配。表5总结了这五个应用程序的特性，挑战和变通方法，我们接下来用它来确定当前无服务器计算状态的四个限制。

#### 3.1细粒度操作的存储空间不足

无服务器平台的无状态特性使得难以支持具有细粒度状态共享需求的应用程序。这主要是由于云提供商提供的现有存储服务的限制。表6总结了现有云存储服务的属性。

对象存储服务（如AWS S3，Azure Blob存储和Google云存储）具有高度可扩展性，可提供廉价的长期对象存储，但具有较高的访问成本和较高的访问延迟。根据最近的测试，所有这些服务至少需要10毫秒才能读取或写入小物体[38]。关于IOPS，在最近的限制增加[39]之后，S3提供了高吞吐量，但它带来了高成本。维持100K IOPS的成本为30美元/分钟[40]，比运行AWS ElastiCache实例多出3到4个数量级[41]。这样的ElastiCache实例在多个轴上提供了更好的性能，具有亚毫秒的读取和写入延迟，并且一个实例配置为运行单线程Redis服务器，IOPS超过100K。

键值数据库，例如AWS DynamoDB，Google Cloud Datastore或Azure Cosmos DB提供高IOPS，但价格昂贵且可能需要很长时间才能扩展.12最后，虽然云提供商提供基于流行的内存存储实例像Memcached或Redis这样的开源项目，它们不具有容错能力，并且不像无服务器计算平台那样自动缩放。

从表5中可以看出，构建在无服务器基础架构上的应用程序需要具有透明配置的存储服务，该存储相当于计算机自动扩展。不同的应用程序可能会激发对持久性和可用性的不同保证，也可能是延迟或其他性能测量。我们认为这需要开发短暂且持久的无服务器存储选项，我们将在第4节进一步讨论。

#### 3.2缺乏细粒度的协调

为了扩展对有状态应用程序的支持，无服务器框架需要提供一种协调任务的方法。例如，如果任务A使用任务B的输出，则必须有一种方法让A知道其输入何时可用，即使A和B驻留在不同的节点上也是如此。许多旨在确保数据一致性的协议也需要类似的协调。

现有的云存储服务都没有通知功能。虽然云提供商确实提供独立的通知服务，例如SNS [42]和SQS [43]，但这些服务会增加显着的延迟，有时会增加数百毫秒。而且，当用于细粒度协调时，它们可能是昂贵的。已经有一些拟议的研究系统如Pocket [44]没有很多这些缺点，但它们尚未被云提供商采用。

因此，应用程序别无选择，只能（1）管理提供通知的基于VM的系统，如ElastiCache和SAND [45]，或者（2）实现自己的通知机制，例如ExCamera [26] ]，使云功能能够通过长时间运行的基于VM的集合点服务器相互通信。此限制还表明，无服务器计算的新变体可能值得探索，例如命名函数实例并允许直接寻址以访问其内部状态（例如，Actors as a Service [46]）。

> 12扩展Google Cloud Datastore的最佳实践包括\ 500/50/5“规则：每秒500次操作，然后每5分钟增加50％.https：//cloud.google.com/datastore/docs/best -practices。

块存储（例如，AWS EBS，IBM块存储）对象存储（例如，AWS S3，Azure Blob存储，Google云存储）文件系统（例如，AWS EFS，Google Filestore）弹性数据库（例如，Google Cloud Datastore，Azure Cosmos） DB）内存存储（例如，AWS ElastiCache，Google Cloud Memorystore）\理想的“无服务器计算存储服务”云功能访问否是是13是是是透明配置否是仅限容量14是15否是可用性和持久性保证本地和持久性分布式和持久性分布式和持久性分布式和持久性本地和短暂各种延迟（平均值）<1ms 10  -  20ms 4  -  10ms 8  -  15ms <1ms <1ms Cost16存储容量（1 GB /月）$ 0.10 $ 0.023 $ 0.30 $ 0.18 {$ 0.25 $ 1.87~ $ 0.10吞吐量（1 MB / s 1个月）$ 0.03 $ 0.0071 $ 6.00 $ 3.15- $ 255.1 $ 0.96~ $ 0.03 IOPS（1 / s 1个月）$ 0.03 $ 7.1 $ 0.23 $ 1- $ 3.15 $ 0.037~ $ 0.03

表6：云提供商对无服务器理想的存储服务的特征。成本是每月存储1 GB（容量），传输1 MB / s（吞吐量）和发出1 IOPS（或30天内240万个请求）的月值。所有值都反映了50/50读/写余额和最小传输大小4 KB。条目的颜色编码为绿色为好，橙色为中等，红色为差。持久性和可用性保证描述了系统容忍故障的程度：本地在一个站点提供可靠的存储，分布式确保能够在站点故障中存活，并且短暂描述驻留在内存中并且可能丢失的数据，例如，在软件的情况下崩溃。无服务器理想将提供与块存储相当的成本和性能，同时为云功能添加透明配置和访问。

#### 3.3标准通信模式的性能不佳

广播，聚合和随机播放是分布式系统中最常见的通信原语。这些操作通常用于机器学习培训和大数据分析等应用程序。图2显示了基于VM和基于功能的解决方案的这些原语的通信模式。

> 13A共享文件系统集成在Azure Functions上，但不集成在其他云功能平台上。

> 14文件系统容量在Azure，AWS，IBM上自动扩展，但不在Google上自动扩展。 IOPS不会独立于任何提供程序的文件系统的存储空间进行扩展。

> 15Google云数据存储和DynamoDB预配置容量自动调节可能很慢，无法响应负载峰值。

> 16对于不按操作收费的服务，例如ElastiCache，我们会线性缩减定价。例如，为了计算1 IOPS的成本，我们采用一个实例的成本，该实例可以用4KB块支持30K IOPS并除以30K。

图2：分布式应用程序的三种常见通信模式：广播，聚合和随机播放。 （a）显示VM实例的这些通信模式，其中每个实例运行两个功能/任务。 （b）显示云功能实例的相同通信模式。请注意，基于VM的解决方案的远程消息数量明显较少。这是因为VM实例提供了充足的机会，可以在发送或接收任务之前在任务中本地共享，聚合或组合数据。

使用基于VM的解决方案，在同一实例上运行的所有任务可以共享正在广播的数据的副本，或者在将部分结果发送到其他实例之前执行本地聚合。因此，广播和聚合操作的通信复杂性是O（N），其中N是系统中VM实例的数量。但是，对于云功能，此复杂性为O（N×K），其中K是每个VM的功能数。洗牌操作的差异更为显着。使用基于VM的解决方案，所有本地任务都可以组合其数据，以便两个VM实例之间只有一条消息。假设相同数量的发送者和接收者产生N2消息。为了比较，使用云功能我们需要发送（N×K）2条消息。由于现有功能的核心数量远少于VM，因此K的范围通常为10到100.由于应用程序无法控制云功能的位置，因此无服务器计算应用程序可能需要发送两个和四个数量级的数据而不是基于VM的等效解决方案。

#### 3.4可预测的性能

尽管云功能的启动延迟比传统的基于VM的实例低得多，但启动新实例时产生的延迟对于某些应用程序来说可能很高。影响此冷启动延迟的因素有三个：（1）启动云功能所需的时间; （2）初始化函数的软件环境所花费的时间，例如，加载Python库; （3）用户代码中特定于应用程序的初始化。后两者可以使前者相形见绌。虽然启动云功能可能需要不到一秒的时间，但加载所有应用程序库可能需要几十秒钟

可预测性能的另一个障碍是硬件资源的可变性，这是由于云提供商可以灵活地选择底层服务器。在我们的实验[47]中，我们有时会收到来自不同硬件代的CPU。这种不确定性暴露了云提供商希望最大限度地利用其资源和可预测性之间的基本权衡。

### 4无服务器计算应该成为什么

现在我们已经解释了今天的无服务器计算及其局限性，让我们展望未来，了解如何将其优势带给更多应用程序。研究人员已经开始解决上面提出的问题，并探讨如何改进无服务器平台以及在其上运行的工作负载的性能[48,49]。我们的伯克利同事和我们中的一些人所做的其他工作强调以数据为中心的分布式系统，机器学习和编程模型挑战以及无服务器计算的机会[50]。在这里，我们广泛地考虑增加适用于无服务器计算的应用程序和硬件类型，确定五个领域的研究挑战：抽象，系统，网络，安全性和架构。

#### 4.1抽象挑战

资源需求：通过今天的无服务器产品，开发人员可以指定云功能的内存大小和执行时间限制，而不是其他资源需求。这种抽象阻碍了那些想要更多控制指定资源的人，例如CPU，GPU或其他类型的加速器。一种方法是使开发人员能够明确指定这些资源需求。但是，这会使云提供商更难通过统计复用实现高利用率，因为它会对功能调度施加更多限制。通过增加云应用程序开发人员的管理开销，它也违背了无服务器的精神。

更好的选择是提高抽象级别，让云提供者推断资源需求，而不是让开发人员指定它们。为此，云提供商可以使用各种方法，从静态代码分析，分析以前的运行，到动态（重新）编译，以将代码重新定位到其他体系结构。自动配置适当数量的内存特别有吸引力，但当解决方案必须与高级语言运行时使用的自动垃圾收集进行交互时尤其具有挑战性。一些研究表明，这些语言运行时可以与无服务器平台集成[51]。

数据依赖性：今天的云功能平台不了解云功能之间的数据依赖性，更不用说这些功能可能交换的数据量。这种无知可能会导致次优放置，从而导致通信模式效率低下，如MapReduce和numpywren示例所示（参见第3节和附录）。

解决这一挑战的一种方法是让云提供商公开一个API，允许应用程序指定其计算图，从而实现更好的布局决策，从而最大限度地减少通信并提高性能。我们注意到许多通用分布式框架（例如，MapReduce，Apache Spark和Apache Beam / Cloud Dataflow [52]），并行SQL引擎（例如，BigQuery，Azure Cosmos DB）以及编排框架（例如，Apache Airflow [ 53]）已经在内部生成这样的计算图。原则上，可以修改这些系统以在云功能上运行并将其计算图暴露给

> 17考虑一个云函数，需要从对象存储加载几百MB的Python库。

云提供商。请注意，AWS Step Functions通过提供状态机语言和API来表示此方向的进展。

#### 4.2系统挑战

高性能，经济实惠，透明配置的存储：如第3节和表5所述，我们看到了两个不同的无需解决的存储需求：无服务器短暂存储和无服务器持久存储。

短暂存储。第3节中的前四个应用程序受限于用于在云功能之间传输状态的存储系统的速度和延迟。虽然它们的容量需求各不相同，但在应用程序生命周期内，所有这些都需要这样的存应用程序完成后，可以丢弃状态。这种短暂存储也可以配置为其他应用程序中的缓存。

为无服务器应用程序提供短暂存储的一种方法是使用优化的网络堆栈构建分布式内存服务，以确保微秒级延迟。该系统将使应用程序的功能能够在应用程序的生命周期内有效地存储和交换状态。这种内存服务需要根据应用程序的需求自动扩展存储容量和IOPS。这种服务的一个独特方面是它不仅需要透明地分配内存，还要透明地释放内存。特别是，当应用程序终止或失败时，应自动释放分配给该应用程序的存储。此管理类似于操作系统在进程完成（或崩溃）时自动释放进程分配的资源。此外，此类存储必须跨应用程序提供访问保护和性能隔离。

RAMCloud [54]和FaRM [55]表明，可以构建内存存储系统，可以提供微秒级别的延迟，并支持每个实例数十万IOPS。他们通过仔细优化整个软件堆栈并利用RDMA来最小化延迟来实现这一性能。但是，它们要求应用程序明确配置存储。它们也不能在多个租户之间提供强大的隔离。最近的另一项努力，Pocket [44]，旨在提供短暂存储的抽象，但也缺乏自动缩放，要求应用程序先验地分配存储。

通过利用统计复用，这种短暂的存储可以比当今的服务器计算更具内存效率。通过服务器计算，如果应用程序需要的内存少于分配的VM实例的聚合内存，那么该内存就会浪费掉。相反，对于共享的内存服务，一个无服务器应用程序未使用的任何内存都可以分配给另一个。事实上，统计多路复用甚至可以使单个应用程序受益：使用服务器计算，VM的未使用内存不能被属于同一应用程序的另一个VM上运行的程序使用，而在共享内存服务的情况下，能够。当然，即使使用无服务器计算，如果云功能不使用其整个本地内存，也可能存在内部碎片。在某些情况下，将云功能的应用程序状态存储在共享的内存服务中可以减轻内部内存碎片的后果。

耐用的存储。与其他应用程序一样，我们的无服务器数据库应用程序实验受到存储系统的延迟和IOPS的限制，但它还需要长期数据存储和文件系统的可变状态语义。虽然数据库功能（包括OLTP）可能会越来越多地作为BaaS产品提供，但我们认为这个应用程序代表了几个需要更长保留和更高耐用性的应用程序。

> 18最近的一个例子是Amazon Aurora无服务器（https://aws.amazon.com/rds/aurora/serverless/）。 Google的BigQuery和AWS Athena等服务基本上是无服务器查询引擎，而不是完全成熟的数据库。

无服务器短暂存储适合提供。要实现高性能无服务器持久存储，一种方法是利用基于SSD的分布式存储与分布式内存缓存配对。最近实现其中许多目标的系统是Anna键值数据库，它通过组合多个现有云存储产品实现了成本效率和高性能[56]。考虑到内存缓存容量可能远低于SSD容量这一事实，这种设计的一个关键挑战是在存在重尾访问分布的情况下实现低尾部延迟。利用新的存储技术[57]，承诺微秒级访问时间，正在成为应对这一挑战的有前途的方法。

与无服务器短暂存储类似，此服务应透明配置，并应确保跨应用程序和租户隔离，以确保安全性和可预测的性能。但是，无应用程序短暂存储将在应用程序终止时回收资源，而无服务器持久存储必须仅显式释放资源（例如，作为\ delete“或\ remove”命令的结果），就像在传统存储系统中一样。此外，它当然必须确保持久性，以便任何已确认的写入都能在失败后继续存在。

协调/信令服务：功能之间的共享状态通常使用生产者消费者设计模式，这需要消费者在生产者可以获得数据时立即知道。类似地，当条件变得可用时，一个函数可能想要发信号通知另一个函数，或者多个函数可能想要协调，例如，以实现数据一致性机制。这种信令系统将受益于微秒级延迟，可靠传送以及广播或组通信。我们还注意到，由于云函数实例不能单独寻址，因此它们不能用于实现教科书分布式系统算法，如共识或领导者选举[50]。

最小化启动时间：启动时间有三个部分（1）调度和启动资源以运行云功能，（2）下载应用软件环境（例如，操作系统，库）以运行功能代码，以及（3）执行特定于应用程序的启动任务，例如加载和初始化数据结构和库。资源调度和初始化可能会因创建隔离的执行环境以及配置客户的VPC和IAM策略而产生显着的延迟和开销。云提供商[14,15]以及其他[58,59]最近专注于通过开发新的轻量级隔离机制来缩短启动时间。

减少（2）的一种方法是利用单核[60]。 Unikernel以两种方式消除传统操作系统产生的开销。首先，代替动态检测硬件，应用用户配置和分配传统操作系统等数据结构，unikernel通过预先配置它们运行的硬件并静态分配数据结构来压缩这些成本。其次，unikernel仅包括应用程序严格要求的驱动程序和系统库，这导致比传统操作系统更小的占用空间。值得注意的是，由于unikernel是针对特定应用程序量身定制的，因此在运行标准化内核的许多实例时，它们无法实现一些可能的效率，例如在同一VM上的不同云功能之间共享内核代码页，或者减少启动时间通过预缓存来节省时间。减少（2）的另一种方法是在应用程序调用库时动态地和递增地加载库，例如，由Azure Functions中使用的共享文件系统启用。

特定于应用程序的初始化（3）是程序员的责任，但是云提供程序可以在其API中包含准备就绪信号，以避免在开始处理函数之前将工作发送到函数实例[61]。更广泛地说，云提供商可以提前执行启动任务[59]。这对于与客户无关的任务尤为强大，例如使用流行的操作系统和一组库来启动VM，因为这些实例的“热池”可以在租户之间共享[13]。

#### 4.3网络挑战

如第3节所述，如图2所示，云功能可能会对流行的通信原语（如广播，聚合和混洗）产生巨大的开销。特别是，假设我们可以在VM实例上打包K个云功能，云功能版本将发送比实例版本多K倍的消息，并且在shuffle的情况下发送K2个更多消息。

可能有多种方法可以解决这一挑战：•提供具有更多核心的云功能，类似于VM实例，因此多个任务可以在通过网络发送或接收之后组合和共享数据。 •允许开发人员明确将云功能放在同一个VM实例上。提供应用程序可以开箱即用的分布式通信原语，以便云提供商可以将云功能分配给同一个VM实例。 •让应用程序提供计算图，使云提供商能够共同定位云功能，以最大限度地减少通信开销（请参阅上面的\抽象挑战）。

请注意，前两个提案可能会降低云提供商放置云功能的灵活性，从而降低数据中心利用率。可以说，它们也违背了无服务器计算的精神，迫使开发人员考虑系统管理。

#### 4.4安全挑战

无服务器计算重新安排了安全责任，将其中许多人从云用户转移到云提供商，而没有从根本上改变它们。但是，无服务器计算还必须解决应用程序分解多租户资源共享中固有的风险。

调度随机化和物理隔离：物理共存是云中硬件级边通道或Rowhammer [62]攻击的中心。作为这类攻击的第一步，对抗性租户需要在同一物理主机上确认与受害者的同居，而不是随意攻击陌生人。云功能的短暂性可能会限制攻击者识别同时运行的受害者的能力。一种随机的，对手感知的调度算法[63]可能会降低共同定位攻击者和受害者的风险，使共同居住攻击更加困难。但是，故意阻止物理共存可能与放置冲突，以优化启动时间，资源利用或通信。

细粒度的安全上下文：云功能需要细粒度的配置，包括访问私钥，存储对象甚至本地临时资源。将要求从现有的服务器应用程序转换安全策略，并提供高度表达的安全API以便在云功能中动态使用。例如，云功能可能必须将安全权限委托给另一个云功能或云服务。使用加密保护的安全上下文的基于能力的访问控制机制可能自然适合这种分布式安全模型。最近的工作[64]建议在多方设置中使用信息流控制进行跨功能访问控制。如果为云功能动态创建短期密钥和证书，则会加剧提供安全原语的分布式管理的其他挑战，例如非模糊性[65]和撤销。

在系统级别，用户要求为每个功能提供更细粒度的安全隔离，至少作为一种选择。提供功能级沙盒的挑战是保持较短的启动时间，而不以在重复的函数调用之间共享状态的方式缓存执行环境。一种可能性是本地快照实例，以便每个功能可以从干净状态开始。或者，轻量级虚拟化技术开始被无服务器提供商采用：库操作系统，包括gVisor [14]，在用户空间\ shim层实现系统API，“而unikernels和microVMs，包括AWS Firecracker [15]，简化客户内核并帮助最小化主机攻击面。与以秒为单位测量的虚拟机启动时间相比，这些隔离技术可将启动时间缩短至几十毫秒。这些解决方案在安全性方面是否实现了与传统虚拟机的奇偶校验显示，我们期望寻找具有低启动开销的强大隔离机制成为正在进行的研究和开发的活跃领域。从积极的方面来看，无服务器计算中的提供商管理和短期实例可以更快地修补漏洞。

对于需要防止共存驻留攻击的用户，一种解决方案是要求物理隔离。最近的硬件攻击（例如，Spectre [66]和Meltdown [67]）也使得保留整个核心甚至整个物理机器对用户具有吸引力。云提供商可以为客户提供高级选项，以便在专用于其使用的物理主机上启动功能。

无意识的无服务器计算：云功能可以通过通信泄漏访问模式和时间信息。对于服务器应用程序，通常批量检索数据，并在本地缓存。相反，由于云功能是短暂的并且在云中广泛分布，因此即使有效载荷是端到端加密的，网络传输模式也可能将更敏感的信息泄露给云中的网络攻击者（例如，雇员）。将无服务器应用程序分解为许多小功能的趋势加剧了这种安全风险。虽然主要的安全问题来自外部攻击者，但通过采用不经意的算法可以保护网络模式免受员工的影响。不幸的是，这些往往有很高的开销[68]。

#### 4.5计算机架构挑战

硬件异构性，定价和易管理性：唉，主宰云的x86微处理器性能几乎没有提升。 2017年，单项计划绩效仅提升3％[69]。假设趋势继续下去，表现将不会翻倍20年。同样，每芯片的DRAM容量接近其极限; 16 Gbit DRAM今天出售，但构建32 Gbit DRAM芯片似乎不可行。这种缓慢变化速度的一线希望是让供应商更换旧电脑，因为它们在当前无服务器市场上几乎没有中断。

通用微处理器的性能问题不会降低对更快计算的需求。前进有两条路[70]。对于使用JavaScript或Python等高级脚本语言编写的函数，硬件 - 软件协同设计可能会导致语言特定的自定义处理器运行速度提高一到三个数量级。另一条前进道路是Domain Specific Architectures。 DSA针对特定问题域进行了定制，并为该域提供了显着的性能和效率提升，但对该域外的应用程序执行效果不佳。图形处理单元（GPU）长期以来一直用于加速图形，我们开始看到用于机器学习的DSA，例如Tensor Processing Units（TPU）。 TPU的性能优于CPU的30倍。这些示例是众多中的第一个，因为针对不同域增强了DSA的通用处理器将成为常态。

如上面4.1节所述，我们看到了无服务器计算的两条路径，以支持即将到来的硬件异构性：

1. 无服务器可以包含多个实例类型，每个会计单位的价格不同，具体取决于所使用的硬件。
2. 云提供商可以自动选择基于语言的加速器和DSA。这种自动化可以基于云功能中使用的软件库或语言隐式完成，例如用于CUDA代码的GPU硬件和用于TensorFlow代码的TPU硬件。或者，云提供商可以监控云功能的性能，并在下次运行时将其迁移到最合适的硬件。

对于x86的SIMD指令，无服务器计算现在在很小的方面面临异构性。 AMD和英特尔通过增加每个时钟周期执行的操作数量并添加新指令，迅速改进了x86指令集的那一部分。对于使用SIMD指令的程序，在具有512位宽SIMD指令的最新Intel Skylake微处理器上运行要比使用128位宽SIMD指令在较旧的Intel Broadwell微处理器上运行要快得多。今天，两个微处理器在AWS Lambda中以相同的价格提供，但目前无服务器计算用户无法表明他们想要更快的SIMD硬件。在我们看来，编译器应该建议哪种硬件最匹配。

随着加速器在云中变得越来越流行，无服务器云提供商将不再能够忽视异构性的困境，特别是因为存在可行的补救措施。

### 5个谬误和陷阱

本节使用轩尼诗和帕特森的谬误和陷阱风格[69]。

谬误由于AWS Lambda云功能实例具有与按需AWS t3.nano实例（0.5 GiB）相同的内存容量，每分钟成本为7.5倍，因此无服务器云计算比服务器云计算更昂贵。

无服务器计算的优点在于价格中包含的所有系统管理功能，包括可用性，监控，日志记录和扩展的冗余。云提供商报告称，当将应用程序迁移到无服务器时，客户可以节省4x-10x的成本[71]。等效功能远远超过单个t3.nano实例，它与单点故障一起运行，信用系统将其限制为每小时CPU使用最多6分钟（两个vCPU的5％），因此它可能会在无服务器容易处理的负载峰值期间拒绝服务。无服务器在更精细的边界处被考虑，包括用于向上和向下扩展，因此在所使用的计算量方面可能更有效。因为在没有调用云功能的事件时不收费，所以无服务器可能会便宜得多。

陷阱无服务器计算可能会产生不可预测的成本。

对于一些用户来说，无服务器计算所采用的纯付费模式的缺点是成本不可预测性，这与许多组织管理其预算的方式不一致。在批准通常每年发生的预算时，组织希望了解明年无服务器服务的成本。这种愿望是一个合理的问题，云提供商可能通过提供基于桶的定价来减轻这种需求，类似于电话公司为某些使用量提供固定费率计划的方式。我们还认为，随着组织越来越多地使用无服务器，他们将能够根据历史记录预测其无服务器计算成本，类似于他们今天为其他公用事业服务（如电力）所采用的方式。

谬误由于无服务器计算编程采用Python等高级语言，因此很容易在无服务器计算提供程序之间移植应用程序。

云服务器计算提供商不仅功能调用语义和包装不同，而且许多无服务器应用程序也依赖于缺乏标准化的专有BaaS产品生态系统。对象存储，键值数据库，身份验证，日志记录和监视是突出的例子。为了实现可移植性，无服务器用户将不得不提出并采用某种标准API，例如POSIX试图为操作系统做的事情。 Google的Knative项目是朝这个方向迈出的一步，旨在为应用程序开发人员提供一套统一的原语，以便在部署环境中使用[61]。

陷阱供应商锁定在无服务器计算方面可能比服务器计算更强。

这个陷阱是先前谬误的结果;如果移植很难，那么很可能是供应商锁定。一些框架承诺通过跨云支持来减轻这种锁定[72]。

Fallacy Cloud功能无法处理需要可预测性能的极低延迟应用。

服务器实例处理这种低延迟应用程序的原因是它们始终处于打开状态，因此它们可以在收到请求时快速回复请求。我们注意到，如果云功能的启动延迟对于给定的应用程序来说不够好，可以使用类似的策略：通过定期运行它们来预热云功能，以确保在任何给定时间有足够的运行时间满足传入的请求。

陷阱几乎没有所谓的“弹性”服务符合无服务器计算的真正灵活性要求。

“弹性”这个词今天是一个流行的术语，但是它被应用于那些不能像最好的无服务器计算服务那样扩展的服务。我们感兴趣的服务可以快速改变他们的容量，用户干预最少，可以在不使用时“扩展到零”。例如，尽管名称如此，但AWS ElastiCache仅允许您实例化整数个Redis实例。其他“弹性”服务需要明确的容量配置，有些需要花费很多时间来响应需求的变化，或者仅在有限的范围内进行扩展。当用户构建结合了高弹性云功能的应用程序时，用户会失去无服务器计算的许多好处。数据库，搜索索引或仅具有有限弹性的服务器应用程序层。没有定量和广泛接受的技术定义或度量标准，有助于比较或组合系统| \ elastic“将仍然是一个模糊的描述符。

### 6总结和预测

通过提供简化的编程环境，无服务器计算使云更易于使用，从而吸引更多能够并将使用它的人。无服务器计算包括FaaS和BaaS产品，标志着云编程的重要成熟。它消除了对当今服务器计算强加给应用程序开发人员的手动资源管理和优化的需求，这种成熟类似于四十多年前从汇编语言到高级语言的转变。

我们预测无服务器的使用将会飙升。我们还预计，随着时间的推移，混合云本地应用程序将逐渐减少，但由于监管限制和数据治理规则，某些部署可能会持续存在。

虽然已经取得了成功，但我们发现了一些挑战，如果克服这些挑战将使无服务器在更广泛的应用程序中流行。第一步是无服务器短暂存储，它必须以合理的成本提供低延迟和高IOPS，但不需要提供经济的长期存储。第二类应用程序将受益于无服务器耐用存储，它确实需要长期存储。新的非易失性存储器技术可以帮助这种存储系统。其他应用程序将受益于低延迟信令服务和对流行通信原语的支持。

无服务器计算的未来面临的两个挑战是提高安全性并适应可能来自专用处理器的成本 - 性能提升。在这两种情况下，无服务器计算都具有可以帮助解决这些挑战的功能。物理共存是旁道攻击的必要条件，但在无服务器计算中更难确认，并且可以轻松采取步骤随机化云功能放置。使用JavaScript，Python或TensorFlow等高级语言编写云函数[73]提高了编程抽象级别，使其更易于创新，从而使底层硬件能够提高性能。

伯克利的云计算视图[2]预测，2009年云计算面临的挑战将得到解决，并且它将蓬勃发展。云业务每年增长50％，并证明云服务提供商的利润很高.19

我们在本文中总结了以下关于未来十年无服务器计算的预测：

•我们希望创建新的BaaS存储服务，以扩展在无服务器计算上运行良好的应用程序类型。这样的存储将与本地块存储的性能相匹配，并且具有短暂且持久的变体。对于无服务器计算，我们将看到比现有的传统x86微处理器更多的计算机硬件异构性。 •我们希望无服务器计算比服务器计算更安全地进行编程，这得益于高级编程抽象和云功能的细粒度隔离。 •我们认为无服务器计算的成本应该高于服务器计算的成本没有根本原因，因此我们预测计费模型将发展，以便几乎任何规模运行的应用程序几乎不会花费更多，也许更少无服务器计算。 •服务器计算的未来将是为了促进BaaS。在无服务器计算之上难以编写的应用程序（例如OLTP数据库或队列等通信原语）可能会作为来自所有云提供商的更丰富服务集的一部分提供。 •虽然服务器式云计算不会消失，但随着无服务器计算克服目前的局限性，云部分的相对重要性将下降。 •无服务器计算将成为云时代的默认计算范例，主要取代服务器计算，从而为客户端 - 服务器时代带来封闭。

> 19Amazon Web Services（AWS）和Microsoft Azure是最大的云提供商。根据2018年的最新报告，AWS在公共云中有41.5％的“应用程序工作负载”，而Azure有29.4％（https://www.skyhighnetworks.com/cloud-security-blog/microsoft-azure-closes-iaasadoption -gap-with-amazon-aws /）。就收入而言，Azure的运行费用为376亿美元，而AWS的运行费用为295亿美元（https://techcrunch.com/2019/02/01/aws-and-）微软获得大最的最benefitsof扩大云市场/）。

### 7致谢

我们要感谢那些对本文早期草稿提供反馈的人：Michael Abd-El-Malek（谷歌），Aditya Akella（威斯康星州），Remzi H. Arpaci-Dusseau（威斯康星州），Bill Bolosky（微软），Forrest Brazeal（Trek10），Eric Brewer（谷歌/加州大学伯克利分校），Armando Fox（加州大学伯克利分校），Changhua He（Ant Financial），Joseph M. Hellerstein（加州大学伯克利分校），Mike Helmick（谷歌），Marvin Theimer（亚马逊网络服务） ，Keith Winstein（斯坦福大学）和Matei Zaharia（斯坦福大学）。 RISELab的赞助商是阿里巴巴集团，亚马逊网络服务，蚂蚁金融，Arm Holdings，Capital One，爱立信，Facebook，谷歌，华为，英特尔，微软，丰业银行，Splunk，VMware和国家科学基金会。

参考

[1] David A. Patterson。数据中心是计算机。 ACM通讯，51（1）：105 {105，2008。

[2] Michael Armbrust，Armando Fox，Rean Griffith，Anthony D. Joseph，Randy H. Katz，Andrew Konwinski，Gunho Lee，David A. Patterson，Ariel Rabkin和Matei Zaharia。云层之上：伯克利的云计算视图。技术报告，2009年。

[3]斯蒂芬奥尔班。云原生或升迁？ https://aws.amazon.com/blogs/ enterprise-strategy / cloud-native-or-lift-and-shift /。访问时间：2019-01-23。

[4] Christina Delimitrou和Christos Kozyrakis。 Quasar：资源有效且支持QoS的集群管理。在第19届国际编程语言和操作系统架构支持会议论文集，ASPLOS '14，第127页{144，纽约，纽约，美国，2014年.ACM。

[5] Jason Mars，Lingjia Tang，Robert Hundt，Kevin Skadron和Mary Lou Soffa。泡沫化：通过明智的共同位置提高现代仓库规模计算机的利用率。在第44届IEEE / ACM国际微体系结构研讨会论文集，第248页{259。 ACM，2011。

[6] Hailong Yang，Alex Breslow，Jason Mars和Lingjia Tang。 Bubble-flux：精确的在线QoS管理，可提高仓库规模计算机的利用率。在第40届国际计算机体系结构研讨会论文集，ISCA '13，第607页，{618，纽约，纽约，美国，2013年.ACM。

[7]无服务器计算和应用程序。 https://aws.amazon.com/serverless/。访问时间：2019-01-23。

[8] Heroku。 https://www.heroku.com。访问时间：2019-01-23。

[9] Firebase。 https://firebase.google.com。访问时间：2019-01-23。

[10]解析。 https://www.parseplatform.org。访问时间：2019-01-23。

[11]通用网关接口（CGI）版本1.1。 https://tools.ietf.org/html/rfc3875。访问时间：2019-01-23.23

[12]王亮，李梦元，张银谦，托马斯里斯特帕特和迈克尔斯威夫特。偷看无服务器平台的窗帘。 2018年USENIX年度技术会议（USENIX ATC 18），第133页{146,2018。

[13] Timothy A. Wagner。计算能力的获取和维护，2018年9月4日。美国专利10067801B1。

[14]开源gVisor，一个沙盒容器运行时。 https://cloud.google.com/blog/ products / gcp / open-sourcing-gvisor-a-sandboxed-container-runtime。访问时间：2019-01-23。

[15] Firecracker轻量级虚拟化，适用于无服务器计算。 https://aws.amazon.com/ blogs / aws / firecracker-lightweight-virtualization-for-serverless-computing /。访问时间：2019-01-23。

[16] Zack Bloom。没有容器的云计算。 https://blog.cloudflare.com/cloudcomputing-without-containers/,2018。访问次数：2019-01-23。

[17]埃里克布鲁尔。 Kubernetes和云原生的道路。在第六届ACM云计算研讨会论文集，SoCC '15，第167页{167，纽约，纽约，美国，2015年.ACM。

[18] Brendan Burns，Brian Grant，David Oppenheimer，Eric Brewer和John Wilkes。博格，欧米茄和Kubernetes。队列，14（1）：10，2016。

[19] AWS Lambda @ Edge。 https://aws.amazon.com/lambda/edge/。访问时间：2019-01-23。

[20] Cloudflare Workers。 https://www.cloudflare.com/products/cloudflare-workers/。访问时间：2019-01-23。

[21] AWS Lambda Greengrass。 https://aws.amazon.com/greengrass/。访问时间：2019-01-23。

[22] 2018无服务器社区调查：无服务器使用量大幅增长。 https：//开头无服务器。 COM /博客/ 2018，无服务器社区勘测巨大的增长使用率/。访问时间：2019-01- 23。

[23]云原生技术正在扩展生产应用程序。 https://www.cncf.io/blog/ 2017/12/06 / cloud-native-technologies-scaling-production-applications /。访问时间：2019-01-23。

[24] Blake Alcott。杰文斯的悖论。生态经济学，54（1）：9 {21,2005。

[25] John L. Hennessy和David A. Patterson。计算机体系结构的新黄金时代。 ACM通讯，62（2）：48 {60，2019年1月。

[26] Sadjad Fouladi，Riad S. Wahby，Brennan Shacklett，Karthikeyan Balasubramaniam，William Zeng，Rahul Bhalerao，Anirudh Sivaraman，George Porter和Keith Winstein。编码，快速和慢速：使用数千个小线程进行低延迟视频处理。在NSDI，第363页{376,2017。

[27] Eric Jonas，Qifan Pu，Shivaram Venkataraman，Ion Stoica和Benjamin Recht。占据云：99％的分布式计算。在2017年云计算研讨会论文集，第445页{451。 ACM，2017年。

[28] DynamoDB。 https://aws.amazon.com/dynamodb/。访问时间：2019-01-23。 24

[29]云数据存储概述。 https://cloud.google.com/datastore/docs/concepts/概述。访问时间：2019-01-23。

[30]史蒂夫亚伯拉罕。介绍Aurora存储引擎。 https://aws.amazon.com/blogs/ database / introduction-the-aurora-storage-engine /，2016。访问日期：2019-01-23。

[31] Cloud Spanner。 https://cloud.google.com/spanner/。访问时间：2019-01-23。

[32] Cosmos DB。 https://docs.microsoft.com/en-us/azure/cosmos-db/introduction。访问时间：2019-01-23。

[33] Matt Freels。 FaunaDB：一个架构概述。 HTTP：//fauna-assets.s3.amazonaws。 COM /公/ FaunaDB技术，Whitepaper.pdf。访问时间：2019-01-23。

[34] Joseph M. Hellerstein，Michael Stonebraker，James Hamilton，et al。数据库系统的体系结构。数据库中的基础和趋势R，1（2）：141 {259,2007。

[35] James C Corbett，Jeffrey Dean，Michael Epstein，Andrew Fikes，Christopher Frost，Jeffrey John Furman，Sanjay Ghemawat，Andrey Gubarev，Christopher Heiser，Peter Hochschild，et al。 Spanner：Google的全球分布式数据库。 ACM计算机系统交易（TOCS），31（3）：8,2013。

[36]蟑螂DB。 https://www.cockroachlabs.com/docs/stable/architecture/overview。 HTML。访问时间：2019-01-23。

[37] NuoDB。 https://www.nuodb.com/。访问时间：2019-01-23。

[38] Sachin Agarwal。 AWS S3，Google Cloud存储和Azure Blob存储中的公共云对象存储性能非常不相等。 https://dev.to/sachinkagarwal/publiccloud-object-store-performance-is-very-unequal-across-aws-s3-google-cloudstorage-and-azure-blob-storage-13do,2018。访问次数：2019- 01-23。

[39] Amazon S3宣布提高请求率性能。 https://aws.amazon.com/ about-aws / whats-new / 2018/07 / amazon-s3-announces-increase-request-rateperformance /。访问时间：2019-01-23。

[40] Amazon S3定价。 https://aws.amazon.com/s3/pricing/。访问时间：2019-01-23。

[41] Amazon ElastiCache定价。 https://aws.amazon.com/elasticache/pricing/。访问时间：2019-01-23。

[42] Amazon SNS vs PubNub：pub / sub的差异。 https://www.pubnub.com/blog/2014- 08-21-amazon-sns-pubnub-differences-pubsub /。访问时间：2019-01-23。

[43] Simson L. Garfinkel。对亚马逊网格计算服务的评估：EC2，S3和SQS。哈佛计算机科学技术报告TR-08-07,2007。

[44] Ana Klimovic，Yawen Wang，Patrick Stuedi，Animesh Trivedi，Jonas Pfefferle和Christos Kozyrakis。 Pocket：用于无服务器分析的弹性短暂存储。在第13届USENIX操作系统设计与实现研讨会（OSDI 18），第427页{444,2018。

[45] Istemi Ekin Akkus，Ruichuan Chen，Ivica Rimac，Manuel Stein，Klaus Satzke，Andre Beck，Paarijaat Aditya和Volker Hilt。 Sand：迈向高性能无服务器计算。 2018年USENIX年度技术会议（USENIX ATC 18），第923页{935,2018

[46] Johann Schleier-Smith。弹性数据库系统的无服务器基础。 CIDR，2019年。

[47] Vaishaal Shankar，Karl Krauth，Qifan Pu，Eric Jonas，Shivaram Venkataraman，Ion Stoica，Benjamin Recht和Jonathan Ragan-Kelley。 numpywren：无服务器线性代数。 arXiv preprint arXiv：1810.09679,2018。

[48] Scott Hendrickson，Stephen Sturdevant，Tyler Harter，Venkateshwaran Venkataramani，Andrea C. Arpaci-Dusseau和Remzi H. Arpaci-Dusseau。使用OpenLambda进行无服务器计算。弹性，60：80。

[49] Ioana Baldini，Paul Castro，Kerry Chang，Perry Cheng，Stephen Fink，Vatche Ishakian，Nick Mitchell，Vinod Muthusamy，Rodric Rabbah，Aleksander Slominski，et al。无服务器计算：当前趋势和未解决的问题。云计算研究进展，第1页{20。施普林格，2017年。

[50] Joseph M. Hellerstein，Jose Faleiro，Joseph E Gonzalez，Johann Schleier-Smith，Vikram Sreekanti，Alexey Tumanov和Wu Chenggang Wu。无服务器计算：前进一步，后退两步。 CIDR，2019年。

[51] James Larisch，James Mickens和Eddie Kohler。 Alto：使用virtualaware托管运行时的轻量级虚拟机。在第15届管理语言和运行时国际会议论文集，第8页，ACM，2018年。

[52] Tyler Akidau，Robert Bradshaw，Craig Chambers，Slava Chernyak，Rafael J. Fern'andezMoctezuma，Reuven Lax，Sam McVeety，Daniel Mills，Frances Perry，Eric Schmidt，et al。数据流模型：在大规模，无限制，无序数据处理中平衡正确性，延迟和成本的实用方法。 VLDB捐赠会议记录，8（12）：1792 {1803,2015。

[53] Apache Airflow。 https://airflow.apache.org。访问时间：2019-01-23。

[54] John Ousterhout，Arjun Gopalan，Ashish Gupta，Ankita Kejriwal，Collin Lee，Behnam Montazeri，Diego Ongaro，Seo Jin Park，Henry Qin，Mendel Rosenblum，et al。 RAMCloud存储系统。 ACM计算机系统交易（TOCS），33（3）：7,2015。

[55] Aleksandar Dragojevi'c，Dushyanth Narayanan，Miguel Castro和Orion Hodson。 FaRM：快速远程内存。在第11届USENIX网络系统设计与实现研讨会（NSDI 14），第401页{414,2014。

[56]吴成刚，Vikram Sreekanti和Joseph M. Hellerstein。在Anna中自动分割分层云存储。 VLDB捐赠的会议记录，12，2019年。

[57]陈。回顾新兴的非易失性存储器（NVM）技术和应用。固态电子学，125：25 {38,2016。

[58] Binaris无服务器功能。 https://binaris.com。访问时间：2019-01-23。

[59] Edward Oakes，Leon Yang，Dennis Zhou，Kevin Houck，Tyler Harter，Andrea Arpaci-Dusseau和Remzi Arpaci-Dusseau。 SOCK：使用无服务器优化的容器进行快速任务配置。 2018年USENIX年度技术会议（USENIX ATC 18），第57页{70,2018

[60] Filipe Manco，Costin Lupu，Florian Schmidt，Jose Mendes，Simon Kuenzer，Sumit Sati，Kenichi Yasukata，Costin Raiciu和Felipe Huici。我的VM比您的容器更轻（也更安全）。 “第26届操作系统原理研讨会论文集”，第218页{233。 ACM，2017年。

[61] Knative：基于Kubernetes的平台，用于构建，部署和管理现代无服务器工作负载。 https://github.com/knative。访问时间：2019-01-23。

[62] Yoongu Kim，Ross Daly，Jeremie Kim，Chris Fallin，Ji Hye Lee，Donghyuk Lee，Chris Wilkerson，Konrad Lai和Onur Mutlu。在不访问它们的情况下翻转内存中的位：对dram扰动错误的实验研究。在ACM SIGARCH计算机体系结构新闻，第42卷，第361页{372。 IEEE出版社，2014年。

[63] Thomas Ristenpart，Eran Tromer，Hovav Shacham和Stefan Savage。嘿，你，离开我的云：探索第三方计算云中的信息泄漏。在第16届ACM计算机和通信安全会议论文集中，第199页{212。 ACM，2009。

[64] Kalev Alpernas，Cormac Flanagan，Sadjad Fouladi，Leonid Ryzhyk，Mooly Sagiv，Thomas Schmitz和Keith Winstein。使用动态信息流控制实现安全无服务器计算。 arXiv preprint arXiv：1802.08984,2018。

[65] Laurent Eschenauer和Virgil D. Gligor。分布式传感器网络的密钥管理方案。 “第9届ACM计算机与通信安全会议论文集”，第41页{47。 ACM，2002。

[66] Paul Kocher，Jann Horn，Anders Fogh，Daniel Genkin，Daniel Gruss，Werner Haas，Mike Hamburg，Moritz Lipp，Stefan Mangard，Thomas Prescher，Michael Schwarz和Yuval Yarom。幽灵攻击：利用投机执行。第40届IEEE安全与隐私研讨会（S＆P'19），2019年。

[67] Moritz Lipp，Michael Schwarz，Daniel Gruss，Thomas Prescher，Werner Haas，Anders Fogh，Jann Horn，Stefan Mangard，Paul Kocher，Daniel Genkin，Yuval Yarom和Mike Hamburg。 Meltdown：从用户空间读取内核内存。在第27届USENIX安全研讨会（USENIX Security 18），2018年。

[68] Elaine Shi，TH Hubert Chan，Emil Stefanov和Mingfei Li。具有O（（log N）3）最坏情况成本的不经意的RAM。在密码学和信息安全理论与应用国际会议上，第197页{214。施普林格，2011年。

[69] John L. Hennessy和David A. Patterson。计算机体系结构：定量方法。 Elsevier，2017年。

[70] John L. Hennessy和David A. Patterson。计算机体系结构的新黄金时代：特定于域的硬件/软件协同设计，增强的安全性，开放式指令集和敏捷芯片开发。图灵讲座，2018年。

[71] Timothy A. Wagner。揭穿无服务器的神话。 https://www.slideshare.net/ TimWagner / serverlessconf-2018-keynote-debunking-serverless-myths，2018。

[72]无服务器公司https://serverless.com。访问时间：2019-01-23。 27

[73]Mart'ınAbadi，Paul Barham，Jianmin Chen，Zhifeng Chen，Andy Davis，Jeffrey Dean，Matthieu Devin，Sanjay Ghemawat，Geoffrey Irving，Michael Isard，et al。 Tensorflow：用于大规模机器学习的系统。在OSDI，2016年。

[74] TPC-DS基准。 http://www.tpc.org/tpcds/。访问时间：2019-01-23。

[75] Mu Li，David G Andersen和Jun Woo Park。使用参数服务器扩展分布式机器学习。在第11届USENIX操作系统设计与实现研讨会（OSDI 18），2014年。

[76] TPC-C。 http://www.tpc.org/tpcc/。访问时间：2019-01-23。 28

### 8附录。五个应用程序的更多深度延伸今天的无服务器计算

#### 8.1 ExCamera：实时视频编码

ExCamera [26]旨在为用户上传视频到YouTube等网站提供实时编码服务。根据视频的大小，今天的编码解决方案可能需要几十分钟甚至几小时。为了实时执行编码，ExCamera将编码的“慢”部分并行化，并按顺序执行\ fast“部分。为此，ExCamera公开了视频编码器和解码器的内部状态，允许使用纯函数语义执行编码和解码任务。特别地，每个任务将内部状态与视频帧一起作为输入，并将修改的内部状态作为输出发出。

ExCamera利用AWS Lambda平台利用新算法的并行性，以便快速扩展计算。与基于VM的实例不同，这些实例需要几分钟才能启动并需要明确管理，因此云功能可在几秒钟内启动，无需管理。

不幸的是，只使用开箱即用的云功能是不够的。 ExCamera任务细粒度，只需几秒钟，并且可以在非常重要的状态下运行。因此，使用S3来交换中间状态会产生显着的开销。此外，云功能是网络地址转换器（NAT）的背后;他们可以发起联系，但不接受他们。这使得云功能之间的直接通信具有挑战性为了解决这个问题，ExCamera使用集合服务器在云功能之间中继数据包。此外，ExCamera还聘请了一名协调员来协调任务以及跨云功能的任务之间的通信。此支持使一个函数调用能够运行多个任务，从而分摊其启动时间。通过这样做，ExCamera提供的延迟比现有编码低得多（比128核上的Google多线程vpxenc编码器快60倍），同时仍然具有成本效益（比在128核x1.32xlarge EC2实例上使用vpxenc编码便宜6.17倍）。

#### 8.2 MapReduce

MapReduce，Hadoop和Spark等分析框架传统上部署在托管集群上。虽然其中一些分析工作负载现在转向无服务器计算，但这些工作负载主要由仅映射作业组成。自然的下一步是支持完全成熟的MapReduce工作。这项工作背后的驱动力之一是利用无服务器计算的灵活性来有效地支持资源需求在执行期间显着变化的作业。例如，TPC-DS基准测试[74]中的查询95由八个阶段组成，每阶段处理0.8 MB到66 GB的数据，几乎相差五个数量级！

在现有云功能平台之上支持MapReduce作业的主要挑战是随机操作。使用shuffle，每个Map任务都会将数据发送到每个reduce任务。假设有M个映射器和R个减速器，则shuffle将产生M×R传输（参见图3（a））。由于云功能不直接相互通信，因此所有这些传输必须通过外部存储进行。转移的数量可能很大。

作为示例，假设我们需要使用S3作为外部存储来使用AWS云功能来移植100 TB的数据。鉴于现有的资源限制，云功能可以处理不超过3 GB的数据块，这是当前云功能的最大内存容量（见表2）.20因此，我们需要将输入划分为33,000个块。如果我们每个块有一个Map函数和相同数量的reduce函数（即M = R = 33; 000），我们需要执行11.1亿次传输，或者22.2亿次IO操作（即一次写入和一读一个

> 20这假设云功能需要在创建输出之前读取所有数据。

图3：（a）使用M个映射器和N个接收器进行随机操作。每次传输都通过外部存储进行，外部存储由一个大的蓝色矩形显示。每个传输对应的数据用小方块表示。 （b）具有S阶段的多阶段洗牌。

传递）！对于像S3这样限制IO操作数/秒（IOPS）并按IO请求收取溢价的系统，此数字非常重要。因此，单独使用S3 IOPS可能需要花费数十小时并且花费12,000美元。

一种替代方案是使用高性能存储，例如ElastiCache21而不是S3。然而，这种高性能存储是昂贵的。使用100 TB这样的存储来重新传输100 TB数据将比基于VM的解决方案昂贵得多。幸运的是，将shuffle分阶段划分（如图3（b）所示）可显着降低所需的高性能存储量。例如，如果我们使用S = 50阶段进行100 TB shuffle，我们只需要2 TB的高性能存储。通过适当选择此存储的大小，我们接近于在性能和成本方面匹配现有的基于VM的框架。

例如，100 TB CloudSort基准测试的当前记录为2,983秒，144美元，使用395个虚拟机群集，每个虚拟机具有4vCPU核心和8GB内存。我们的解决方案使用云功能（使用AWS Lambda支付117美元）和云对象存储（AWS S3 IOPS成本为14美元）和ElastiCache服务（Redis成本为32美元）混合使用，以2,945秒的价格运行相同的任务，价格为163美元。

#### 8.3 Numpywren：线性代数

大规模线性代数计算传统上部署在由高速，低延迟网络连接的超级计算机或高性能计算集群上。鉴于此历史，无服务器计算最初似乎不合适。

然而，无线服务器计算对线性代数计算仍然有意义的原因有两个。首先，管理集群是许多非CS科学家的一大障碍。其次，在计算过程中，并行度可能会发生很大变化。图4显示了Cholesky分解的工作集和最大并行度，这是在大矩阵上求解线性方程的最常用方法之一。配置具有固定大小的群集将减慢作业速度或使群集未得到充分利用。

> 21Elasticache基于Redis。单个单线程Redis实例可以处理100K + IOPS。 100个实例可以在130秒内处理1.3B传输。

图4：分布式Cholesky分解中任务并行度和工作集大小随时间变化的理论概况。

最近关于numpywren项目的工作表明，无服务器计算可能是大规模线性代数的良好匹配[47]。关键的见解是，对于许多线性代数运算，计算时间通常主导大型问题规模的通信。例如，Cholesky，LU和奇异值分解都表现出O（n3）计算和O（n2）通信复杂性。 Numpywren利用这一观察结果，并展示了许多流行的算法，即使在使用S3等高延迟存储系统时，无服务器计算实现也可以实现与在专用群集上运行的优化MPI实现（ScaLAPACK）相当的性能。对于某些线性代数算法，如矩阵乘法和Cholesky分解和奇异值分解，numpywren的性能（完成时间）仅为1.3倍（对于所有算法）的ScaLAPACK，其CPU消耗（总CPU小时数）为1.3x乘以，Cholesky为0.77倍，SVD为0.44倍。目前，云服务提供商对其无服务器产品的CPU核心秒定价收取2倍的溢价，因此numpywren对于SVD算法来说更便宜。随着效率的提高和竞争的加剧，我们预计保费比率将进一步下降，从而扩大了numpywren的成本效益。

虽然这些结果很有希望，但对线性代数使用无服务器计算有一些局限性。首先，numpywren只能与大型问题规模（通常大于256K×256K密集矩阵运算）的专用实现竞争;外部存储的高延迟使得系统对于较小的问题实例而言缺乏竞争力。更严重的限制是现有的云功能平台不能有效地实现广播通信模式（图2），这种模式被诸如QR分解的几种流行算法所采用。这种低效率的产生是因为每个云功能提供的核心很少（通常不超过1或2），并且因为应用程序没有控制功能放置。

作为通信效率低下的一个例子，考虑N个大型机器或VM，每个机器或VM都有K个核心。广播操作只需要通过网络发送N个数据副本，每个机器一个，所有核心可以共享同一个副本。如果我们假设使用云功能进行等效部署，其中每个功能在单独的计算机上具有单个核心，那么我们需要通过网络发送N×K个数据副本以达到相同数量的核心。因此，在这种情况下，网络流量高出K倍，这是一个非平凡的开销。图2（a）说明了N = K = 2的这个例子，假设每个节点有2个核心，每个函数使用一个核心，因此可以运行两个函数。

#### 8.4 Cirrus：机器学习培训

机器学习研究人员传统上使用VM群集来处理ML工作流中的不同任务，例如预处理，模型训练和超参数调整。这种方法的一个挑战是管道的不同阶段可能需要显着不同的资源量。与线性代数算法一样，固定的簇大小将导致严重的未充分利用或严重减速。无服务器计算可以通过独立扩展每个阶段来满足其资源需求来应对这一挑战。此外，它使开发人员免于管理这些服务器。

最近关于Cirrus项目的工作为无人机计算的ML培训管道提供了希望。 Cirrus利用了三个主要观察结果。首先，现有的无服务器产品提供高达数千个核心的计算（云功能）和存储吞吐量（例如，到S3）的线性可扩展性。其次，缓存和预取训练数据可能会使CPU饱和。第三，相对少量的高性能存储可以显着改善这些管道的性能，特别是培训。在Cirrus的情况下，我们使用一些VM实例来提供这种高性能存储，以实现内存中的参数服务器[75]。

对ML工作负载使用无服务器计算仍然具有挑战性。首先，需要将渐变广播到每个云函数。如前一节所述，如图2所示，与大型VM实例相比，使用云功能会产生更高的通信开销。其次，参数服务器必须处理异步细粒度更新。由于带宽和数据包数量，这可能会严重影响其网络连接。

我们已经针对三个基于VM的ML框架评估了Cirrus：Tensorflow，Bosen和Spark。在稀疏逻辑回归工作量上，Cirrus有10名lambda工作者比Tensorflow（1 x m5d.4xlarge，32个核心）快3倍，比Bosen快2倍（2 x m5d.4xlarge，16个核心）。在协同过滤工作量上，Cirrus在更短的时间内收敛到更低的损失（RMSE为0.83 vs. 0.85）。尽管Cirrus在训练完成时间方面的表现优于服务器，但它的成本并不高于成本，可能高出7倍。

#### 8.5无服务器SQLite：数据库

有状态的工作负载（如数据库）对于无服务器计算尤其具有挑战性。乍一看，这些服务体现了无服务器计算的无状态特性的对立面。虽然云提供商提供了许多具有一定弹性的托管数据库服务[28 {32]，但一个有趣的问题是第三方是否可以直接在无服务器计算平台上实现无服务器数据库。

一个稻草人解决方案是在无服务器功能内运行常见的事务数据库，如PostgreSQL，Oracle或MySQL。然而，这立即遇到了许多挑战。首先，无服务器计算没有内置的持久存储，因此我们需要使用远程持久存储，这会带来大的延迟。其次，这些数据库假设面向连接的协议，即数据库作为接受来自客户端的连接的服务运行。此假设与在网络地址转换器后面运行的现有云功能冲突，因此不支持传入连接。最后，虽然许多高性能数据库依赖于共享内存[34]，但云功能是孤立运行的，因此无法共享内存。 Sharednothing分布式数据库[35 {37]不需要共享内存，但是他们希望节点可以直接在网络上寻址，并且他们希望集群成员资格只能缓慢地改变。所有这些问题都对在无服务器计算上运行传统数据库软件或实现等效功能提出了重大挑战。

尽管存在这些挑战，我们确实成功地在无服务器计算平台上运行SQLite嵌入式数据库。 SQLite作为应用程序库运行，因此不需要支持入站网络连接。此外，SQLite不需要共享内存，而是依赖于对快速，缓存的共享文件系统的访问。我们在无服务器环境中提供此类文件系统的方法是在SQLite和云提供商的网络文件系统（例如，AWS EFS或Azure文件）之间插入内存中的事务缓存缓冲层。通过在隐藏文件中维护更改日志，我们为共享文件系统访问提供事务隔离和有效缓存。这与无服务器计算一样，支持数百个并发功能和亚毫秒延迟，在修改后的只读TPC-C基准测试中实现超过1000万tpmC（每分钟事务数）[76]，性能可与商用RDBMS系统相媲美报告未修改的基准。虽然这些未经修改的基准测试包含大约70％的写入，但由于依赖于数据库级锁定，我们的写入可扩展性仅达到大约100的tpmC。

我们的结论是，大多数类似数据库的应用程序将继续作为BaaS提供，除非应用程序自然地使对数据库的写入很少。
